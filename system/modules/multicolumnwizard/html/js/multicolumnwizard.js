var MultiColumnWizard={execute:function(e,g,c){var p=$(c);var l=p.getFirst().getNext();var o=$(e).getParent("tr");var s={maxCount:p.getProperty("rel").match(/maxCount\[[0-9]+\]/ig)[0].replace("maxCount[","").replace("]","").toInt(),minCount:p.getProperty("rel").match(/minCount\[[0-9]+\]/ig)[0].replace("minCount[","").replace("]","").toInt(),uniqueFields:p.getProperty("rel").match(/unique\[[a-z0-9,]*\]/ig)[0].replace("unique[","").replace("]","").split(","),datepickers:p.getProperty("rel").match(/datepicker\[[a-z0-9,]*\]/ig)[0].replace("datepicker[","").replace("]","").split(",")};if(window.Backend){Backend.getScrollOffset()}MultiColumnWizard[g](l,o,s);var q=l.getChildren();for(var k=0;k<q.length;k++){var n=q[k].getChildren();for(var h=0;h<n.length;h++){var d=n[h].getChildren();MultiColumnWizard.updateFieldName(d,k)}q[k].getElements("select, input, textarea").each(function(j){if(j.get("type")=="checkbox"||j.get("type")=="radio"){j.checked?j.setAttribute("checked","checked"):j.removeAttribute("checked")}else{if(j.get("tag")=="select"&&j.selectedIndex>0){var i=j.getChildren();i.each(function(t,r){if(j.selectedIndex==r){t.setAttribute("selected",true)}else{t.removeAttribute("selected")}})}else{j.setAttribute("value",j.value)}}});q[k].set("html",q[k].get("html").replace(/_row[0-9]+_/ig,"_row"+k+"_"))}if(s.datepickers.length>1||s.datepickers[0]!=""){for(var k=0;k<s.datepickers.length;k++){var b=[];for(var a=0;a<q.length;a++){var f=c+"_row"+a+"_"+s.datepickers[k];document.id(f).setStyle("display","inline-block").getNext().destroy();b.include(f)}var m=c.replace("ctrl_","datepicker_")+"_"+s.datepickers[k];window[m].attachTo="#"+b.join(",#");window[m].options.toggleElements="#"+b.join(",#").replace(/ctrl_/g,"toggle_");window[m].attach()}}},copy:function(b,f,a){var h=new Element("tr");var g=f.getChildren();for(var c=0;c<g.length;c++){var e=g[c].clone(true,true).injectInside(h);e.getFirst().value=g[c].getFirst().value}h.injectAfter(f);if(a.maxCount<=b.getChildren().length&&a.maxCount!=0){b.getElements("img[src=system/themes/default/images/copy.gif]").getParent().setStyle("display","none")}if(a.minCount<b.getChildren().length&&a.minCount!=0){b.getElements("img[src=system/themes/default/images/delete.gif]").getParent().setStyle("display","inline")}if(a.uniqueFields.length>1||a.uniqueFields[0]!=""){for(var c=0;c<a.uniqueFields.length;c++){var d=h.getElements("*[name*=["+a.uniqueFields[c]+"]]");if(d){MultiColumnWizard.clearElementValue(d)}}}},up:function(b,c,a){c.getPrevious()?c.injectBefore(c.getPrevious()):c.injectInside(b)},down:function(b,c,a){c.getNext()?c.injectAfter(c.getNext()):c.injectBefore(b.getFirst())},"delete":function(b,d,a){if(b.getChildren().length>1){d.destroy()}else{var e=d.getElements("input,select,textarea");for(var c=0;c<e.length;c++){MultiColumnWizard.clearElementValue(e[c])}}if(a.maxCount>b.getChildren().length){b.getElements("img[src=system/themes/default/images/copy.gif]").getParent().setStyle("display","inline")}if(a.minCount>=b.getChildren().length){b.getElements("img[src=system/themes/default/images/delete.gif]").getParent().setStyle("display","none")}},updateFieldName:function(a,b){a.each(function(f){if(f.name!=undefined&&f.name!=null&&f.name!=""){var d=f.name.substring(0,f.name.indexOf("["));if(Browser.ie||Browser.Engine.trident){var e=f.name;var c=f.name.replace(new RegExp(d+"[[0-9]+]","ig"),d+"["+b+"]");if(e!=c){f.mergeAttributes(document.createElement("<INPUT name='"+c+"'/>"),false)}}else{f.name=f.name.replace(new RegExp(d+"[[0-9]+]","ig"),d+"["+b+"]")}}if(f.getChildren().length>0){MultiColumnWizard.updateFieldName(f.getChildren(),b)}})},clearElementValue:function(a){if(a.get("type")=="checkbox"||a.get("type")=="radio"){a.checked=false}else{a.set("value","")}}};